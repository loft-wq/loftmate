<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'>
  <head>
    
    <meta content='width=device-width, initial-scale=1.0, user-scalable=yes' name='viewport'/>
    <meta content='telephone=no' name='format-detection'/>

    <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }
      
      :root {
          --primary-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          --card-bg: #ffffff;
          --text-color: #333333;
          --text-secondary: #666666;
          --border-color: #f1f3f4;
          --shadow: rgba(0,0,0,0.1);
      }
      
      [data-theme="dark"] {
          --primary-bg: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
          --card-bg: #2d3748;
          --text-color: #ffffff;
          --text-secondary: #cbd5e0;
          --border-color: #4a5568;
          --shadow: rgba(0,0,0,0.3);
      }
      
      body {
          font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
          background: var(--primary-bg);
          margin: 0;
          padding: 8px;
          min-height: 100vh;
          line-height: 1.6;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          touch-action: manipulation;
          color: var(--text-color);
          transition: all 0.3s ease;
      }
      
      .container {
          max-width: 1200px;
          margin: 0 auto;
          background: rgba(255,255,255,0.95);
          border-radius: 20px;
          padding: 15px;
          box-shadow: 0 15px 35px var(--shadow);
          backdrop-filter: blur(15px);
          border: 1px solid rgba(255,255,255,0.2);
      }
      
      [data-theme="dark"] .container {
          background: rgba(45, 55, 72, 0.95);
          border: 1px solid rgba(255,255,255,0.1);
      }
      
      .header {
          text-align: center;
          background: linear-gradient(135deg, #667eea, #764ba2);
          color: white;
          padding: 25px 15px;
          border-radius: 15px;
          margin-bottom: 20px;
          position: relative;
          overflow: hidden;
          box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      }
      
      .header::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: radial-gradient(circle at 30% 20%, rgba(255,255,255,0.1) 0%, transparent 50%);
          pointer-events: none;
      }
      
      .header h1 {
          margin: 0;
          font-size: clamp(1.8rem, 5vw, 2.5rem);
          font-weight: 700;
          text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
          position: relative;
          z-index: 1;
      }
      
      .header p {
          margin: 10px 0 0 0;
          opacity: 0.9;
          font-size: clamp(0.9rem, 3vw, 1.1rem);
          position: relative;
          z-index: 1;
      }
      
      .theme-toggle {
          position: absolute;
          top: 15px;
          right: 15px;
          background: rgba(255,255,255,0.2);
          border: none;
          color: white;
          padding: 10px;
          border-radius: 50%;
          cursor: pointer;
          font-size: 1.2rem;
          transition: all 0.3s ease;
          z-index: 2;
      }
      
      .theme-toggle:hover {
          background: rgba(255,255,255,0.3);
          transform: scale(1.1);
      }
      
      .stats-bar {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 15px;
          margin-bottom: 25px;
          padding: 20px;
          background: var(--card-bg);
          border-radius: 15px;
          box-shadow: 0 4px 15px var(--shadow);
      }
      
      .stat-item {
          text-align: center;
          padding: 15px;
          border-radius: 12px;
          background: linear-gradient(135deg, #667eea, #764ba2);
          color: white;
          box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
      }
      
      .stat-number {
          font-size: 2rem;
          font-weight: 700;
          display: block;
      }
      
      .stat-label {
          font-size: 0.9rem;
          opacity: 0.9;
          margin-top: 5px;
      }
      
      .search-filters {
          background: var(--card-bg);
          padding: 20px;
          border-radius: 15px;
          margin-bottom: 20px;
          box-shadow: 0 4px 15px var(--shadow);
      }
      
      .search-row {
          display: grid;
          grid-template-columns: 2fr 1fr 1fr 1fr auto;
          gap: 15px;
          align-items: end;
      }
      
      .login-form {
          max-width: 400px;
          margin: 20px auto;
          padding: 30px 25px;
          background: var(--card-bg);
          border-radius: 20px;
          box-shadow: 0 10px 30px var(--shadow);
          border: 1px solid var(--border-color);
      }
      
      .login-form h2 {
          text-align: center;
          color: var(--text-color);
          margin-bottom: 25px;
          font-size: clamp(1.5rem, 4vw, 2rem);
          font-weight: 600;
      }
      
      .form-group {
          margin-bottom: 20px;
      }
      
      .form-group label {
          display: block;
          margin-bottom: 8px;
          font-weight: 600;
          color: var(--text-color);
          font-size: 0.95rem;
      }
      
      .form-group input, 
      .form-group select, 
      .form-group textarea {
          width: 100%;
          padding: 16px 15px;
          border: 2px solid var(--border-color);
          border-radius: 12px;
          font-size: 16px;
          transition: all 0.3s ease;
          background: var(--card-bg);
          color: var(--text-color);
          -webkit-appearance: none;
          -moz-appearance: none;
          appearance: none;
      }
      
      .form-group select {
          background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
          background-repeat: no-repeat;
          background-position: right 12px center;
          background-size: 20px;
          padding-right: 45px;
      }
      
      .form-group input:focus, 
      .form-group select:focus, 
      .form-group textarea:focus {
          border-color: #667eea;
          outline: none;
          box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
          transform: translateY(-2px);
      }
      
      .btn {
          background: linear-gradient(135deg, #667eea, #764ba2);
          color: white;
          border: none;
          padding: 16px 24px;
          border-radius: 12px;
          cursor: pointer;
          font-size: 16px;
          font-weight: 600;
          margin: 6px;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          text-decoration: none;
          display: inline-block;
          position: relative;
          overflow: hidden;
          min-height: 48px;
          touch-action: manipulation;
          user-select: none;
          -webkit-user-select: none;
          -webkit-tap-highlight-color: transparent;
      }
      
      .btn:hover:not(:active) {
          transform: translateY(-3px);
          box-shadow: 0 12px 25px rgba(102, 126, 234, 0.4);
      }
      
      .btn:active {
          transform: translateY(-1px);
          transition: transform 0.1s;
      }
      
      .btn-success { 
          background: linear-gradient(135deg, #28a745, #20c997);
      }
      .btn-success:hover:not(:active) {
          box-shadow: 0 12px 25px rgba(40, 167, 69, 0.4);
      }
      
      .btn-info { 
          background: linear-gradient(135deg, #17a2b8, #6f42c1);
      }
      .btn-info:hover:not(:active) {
          box-shadow: 0 12px 25px rgba(23, 162, 184, 0.4);
      }
      
      .btn-warning { 
          background: linear-gradient(135deg, #ffc107, #fd7e14);
      }
      .btn-warning:hover:not(:active) {
          box-shadow: 0 12px 25px rgba(255, 193, 7, 0.4);
      }
      
      .btn-danger { 
          background: linear-gradient(135deg, #dc3545, #e83e8c);
      }
      .btn-danger:hover:not(:active) {
          box-shadow: 0 12px 25px rgba(220, 53, 69, 0.4);
      }
      
      .btn-cancel { 
          background: linear-gradient(135deg, #6c757d, #495057);
      }
      .btn-cancel:hover:not(:active) {
          box-shadow: 0 12px 25px rgba(108, 117, 125, 0.4);
      }
      
      .btn-small {
          padding: 8px 12px;
          font-size: 12px;
          min-height: 32px;
          margin: 2px;
      }
      
      .nav-buttons {
          text-align: center;
          margin-bottom: 25px;
          padding: 20px 15px;
          background: var(--card-bg);
          border-radius: 18px;
          backdrop-filter: blur(10px);
          border: 1px solid var(--border-color);
          box-shadow: 0 4px 15px var(--shadow);
      }
      
      .user-info {
          background: var(--card-bg);
          padding: 18px 20px;
          border-radius: 15px;
          margin-bottom: 20px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          box-shadow: 0 6px 20px var(--shadow);
          border: 1px solid var(--border-color);
          flex-wrap: wrap;
          gap: 10px;
      }
      
      .pigeon-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
          gap: 20px;
          margin-top: 20px;
      }
      
      .pigeon-card {
          background: var(--card-bg);
          border: 2px solid var(--border-color);
          border-radius: 18px;
          padding: 22px;
          box-shadow: 0 6px 25px var(--shadow);
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          position: relative;
          overflow: hidden;
          cursor: pointer;
      }
      
      .pigeon-card::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 4px;
          background: linear-gradient(90deg, #667eea, #764ba2);
          transform: scaleX(0);
          transition: transform 0.4s ease;
      }
      
      .pigeon-card:hover::before {
          transform: scaleX(1);
      }
      
      .pigeon-card:hover {
          border-color: #667eea;
          transform: translateY(-8px);
          box-shadow: 0 20px 40px rgba(102, 126, 234, 0.2);
      }
      
      .pigeon-card:active {
          transform: scale(0.98);
          transition: transform 0.1s;
      }
      
      .pigeon-number {
          font-size: clamp(1.4rem, 4vw, 1.8rem);
          font-weight: 700;
          color: #667eea;
          margin-bottom: 12px;
          text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      }
      
      .pigeon-name {
          font-size: clamp(1.1rem, 3vw, 1.3rem);
          color: var(--text-color);
          margin-bottom: 15px;
          font-weight: 600;
          word-break: break-word;
      }
      
      .pigeon-country {
          font-size: clamp(2rem, 6vw, 2.5rem);
          position: absolute;
          top: 20px;
          right: 22px;
          opacity: 0.8;
          transition: all 0.3s ease;
      }
      
      .pigeon-card:hover .pigeon-country {
          transform: scale(1.2);
          opacity: 1;
      }
      
      .expand-arrow {
          position: absolute;
          top: 20px;
          right: 60px;
          font-size: 1.2rem;
          color: #667eea;
          transition: transform 0.3s ease;
          pointer-events: none;
      }
      
      .expand-arrow.rotated {
          transform: rotate(180deg);
      }
      
      .pigeon-summary {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 10px;
          padding: 10px 15px;
          border-radius: 8px;
          background: rgba(102, 126, 234, 0.05);
          font-weight: 600;
          color: var(--text-color);
      }
      
      .pigeon-details {
          margin-top: 18px;
          padding-top: 18px;
          border-top: 2px solid var(--border-color);
          max-height: 0;
          overflow: hidden;
          transition: all 0.4s ease;
          opacity: 0;
      }
      
      .pigeon-details.expanded {
          max-height: 1000px;
          opacity: 1;
          padding-top: 18px;
      }
      
      .detail-row {
          display: flex;
          justify-content: space-between;
          margin-bottom: 10px;
          padding: 6px 0;
          align-items: flex-start;
          gap: 10px;
      }
      
      .detail-label {
          font-weight: 600;
          color: var(--text-color);
          flex: 1;
          min-width: 0;
      }
      
      .detail-value {
          color: var(--text-secondary);
          flex: 1;
          text-align: right;
          font-weight: 500;
          min-width: 0;
          word-break: break-word;
      }
      
      .card-actions {
          margin-top: 15px;
          display: flex;
          gap: 8px;
          justify-content: center;
          border-top: 1px solid var(--border-color);
          padding-top: 15px;
      }
      
      .race-badge {
          display: inline-block;
          background: linear-gradient(135deg, #28a745, #20c997);
          color: white;
          padding: 4px 12px;
          border-radius: 20px;
          font-size: 0.8rem;
          font-weight: 600;
          margin-top: 10px;
      }
      
      .year-section {
          margin-bottom: 35px;
      }
      
      .year-title {
          background: linear-gradient(135deg, #667eea, #764ba2);
          color: white;
          padding: 18px 20px;
          border-radius: 15px;
          font-size: clamp(1.3rem, 4vw, 1.6rem);
          font-weight: 700;
          margin-bottom: 20px;
          text-align: center;
          box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
      }
      
      .hidden { 
          display: none !important; 
      }
      
      .form-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 15px;
          margin-bottom: 20px;
      }
      
      .notes-box {
          background: var(--card-bg);
          border: 1px solid var(--border-color);
          padding: 15px;
          border-radius: 12px;
          margin-top: 15px;
          border-left: 4px solid #667eea;
          font-style: italic;
          box-shadow: 0 3px 12px var(--shadow);
          word-break: break-word;
      }
      
      .empty-state {
          text-align: center;
          padding: 50px 20px;
          color: var(--text-secondary);
          font-size: clamp(1rem, 3vw, 1.2rem);
      }
      
      .empty-state::before {
          content: '🐦';
          display: block;
          font-size: clamp(3rem, 8vw, 4rem);
          margin-bottom: 20px;
          opacity: 0.6;
      }
      
      .click-hint {
          text-align: center;
          margin-bottom: 20px;
          padding: 10px;
          background: rgba(102, 126, 234, 0.1);
          border-radius: 8px;
          color: #667eea;
          font-weight: 600;
      }
      
      .modal {
          display: none;
          position: fixed;
          z-index: 1000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0,0,0,0.5);
          backdrop-filter: blur(5px);
      }
      
      .modal-content {
          background-color: var(--card-bg);
          margin: 5% auto;
          padding: 20px;
          border-radius: 15px;
          width: 90%;
          max-width: 600px;
          max-height: 80vh;
          overflow-y: auto;
          box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      }
      
      .close {
          color: var(--text-secondary);
          float: right;
          font-size: 28px;
          font-weight: bold;
          cursor: pointer;
          line-height: 1;
      }
      
      .close:hover {
          color: var(--text-color);
      }
      
      .import-export {
          display: flex;
          gap: 10px;
          align-items: center;
          margin-bottom: 20px;
      }
      
      .file-input {
          display: none;
      }
      
      .file-label {
          background: linear-gradient(135deg, #17a2b8, #6f42c1);
          color: white;
          padding: 12px 20px;
          border-radius: 8px;
          cursor: pointer;
          transition: all 0.3s ease;
          font-weight: 600;
      }
      
      .file-label:hover {
          transform: translateY(-2px);
          box-shadow: 0 8px 20px rgba(23, 162, 184, 0.4);
      }
      
      @media (max-width: 768px) {
          body {
              padding: 5px;
          }
          
          .container {
              padding: 12px;
              border-radius: 15px;
              margin: 0;
          }
          
          .header {
              padding: 20px 12px;
              margin-bottom: 15px;
              border-radius: 12px;
          }
          
          .login-form {
              padding: 25px 20px;
              margin: 15px auto;
              border-radius: 15px;
          }
          
          .form-row {
              grid-template-columns: 1fr;
              gap: 12px;
          }
          
          .search-row {
              grid-template-columns: 1fr;
              gap: 10px;
          }
          
          .stats-bar {
              grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
              gap: 10px;
              padding: 15px;
          }
          
          .pigeon-grid {
              grid-template-columns: 1fr;
              gap: 15px;
          }
          
          .user-info {
              flex-direction: column;
              text-align: center;
              padding: 15px;
              gap: 12px;
          }
          
          .nav-buttons {
              padding: 15px 10px;
          }
          
          .btn {
              padding: 14px 20px;
              margin: 4px;
              font-size: 15px;
              min-height: 44px;
          }
          
          .pigeon-card {
              padding: 18px;
              border-radius: 15px;
          }
          
          .pigeon-country {
              font-size: 2rem;
              top: 15px;
              right: 18px;
          }
          
          .expand-arrow {
              right: 50px;
              font-size: 1rem;
          }
          
          .pigeon-summary {
              flex-direction: column;
              align-items: flex-start;
              gap: 5px;
              text-align: left;
          }
          
          .detail-row {
              flex-direction: column;
              gap: 4px;
              align-items: flex-start;
          }
          
          .detail-label, 
          .detail-value {
              text-align: left;
          }
          
          .detail-value {
              color: var(--text-color);
              font-weight: 600;
          }
          
          .modal-content {
              margin: 10% auto;
              width: 95%;
              padding: 15px;
          }
      }
      
      @media (max-width: 480px) {
          .pigeon-grid {
              grid-template-columns: 1fr;
              gap: 12px;
          }
          
          .pigeon-card {
              padding: 15px;
              border-radius: 12px;
          }
          
          .btn {
              width: 100%;
              margin: 4px 0;
          }
          
          .nav-buttons .btn {
              width: auto;
              margin: 4px 2px;
              padding: 12px 16px;
              font-size: 14px;
          }
          
          .form-group input, 
          .form-group select, 
          .form-group textarea {
              padding: 14px 12px;
              font-size: 16px;
          }
      }
      
      @media (max-width: 360px) {
          .nav-buttons .btn {
              width: 100%;
              margin: 3px 0;
          }
          
          .pigeon-card {
              padding: 12px;
          }
          
          .pigeon-country {
              font-size: 1.8rem;
          }
      }

      @media (hover: none) and (pointer: coarse) {
          .btn:hover {
              transform: none;
              box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
          }
          
          .pigeon-card:hover {
              transform: none;
              box-shadow: 0 6px 25px rgba(0,0,0,0.1);
          }
      }
      
      .fade-in {
          animation: fadeIn 0.6s ease-out;
      }
      
      @keyframes fadeIn {
          from { 
              opacity: 0; 
              transform: translateY(20px); 
          }
          to { 
              opacity: 1; 
              transform: translateY(0); 
          }
      }
      
      .slide-in {
          animation: slideIn 0.4s ease-out;
      }
      
      @keyframes slideIn {
          from { 
              transform: translateX(-100%); 
              opacity: 0;
          }
          to { 
              transform: translateX(0); 
              opacity: 1;
          }
      }
      
      .btn:disabled {
          opacity: 0.6;
          cursor: not-allowed;
          transform: none !important;
      }
      
      .btn.loading::after {
          content: '';
          position: absolute;
          width: 16px;
          height: 16px;
          margin: auto;
          border: 2px solid transparent;
          border-top-color: #ffffff;
          border-radius: 50%;
          animation: button-loading-spinner 1s ease infinite;
      }
      
      @keyframes button-loading-spinner {
          from {
              transform: rotate(0turn);
          }
          to {
              transform: rotate(1turn);
          }
      }
      
      @keyframes fadeOut {
          from { opacity: 1; transform: translateX(0); }
          to { opacity: 0; transform: translateX(100%); }
      }
    </style>
  </head>

  <body>
    <div class='container'>
      <div class='header fade-in'>
        <button class='theme-toggle' onclick='toggleTheme()' title='تبديل الوضع المظلم/النهاري'>🌙</button>
        <h1>Colombier App</h1>
        <p>Application de gestion des pigeons voyageurs</p>
      </div>

      <div class='fade-in' id='loginSection'>
        <div class='login-form'>
          <h2>Bienvenue</h2>
          <div class='form-group'>
            <label>Nom d&#39;utilisateur :</label>
            <input autocomplete='username' id='username' placeholder='Entrez votre nom' type='text'/>
          </div>
          <div class='form-group'>
            <label>Mot de passe :</label>
            <input autocomplete='current-password' id='password' placeholder='Entrez votre mot de passe' type='password'/>
          </div>
          <button class='btn' onclick='login()' style='width: 100%;'>Se connecter</button>
        </div>
      </div>
      
      <div class='hidden' id='mainApp'>
        <div class='user-info slide-in'>
          <span>Bienvenue, <strong id='currentUser'/></span>
          <button class='btn btn-cancel' onclick='logout()'>Déconnexion</button>
        </div>

        <!-- Statistics Bar -->
        <div class='stats-bar fade-in'>
          <div class='stat-item'>
            <span class='stat-number' id='totalCount'>0</span>
            <div class='stat-label'>Total Pigeons</div>
          </div>
          <div class='stat-item'>
            <span class='stat-number' id='maleCount'>0</span>
            <div class='stat-label'>Mâles</div>
          </div>
          <div class='stat-item'>
            <span class='stat-number' id='femaleCount'>0</span>
            <div class='stat-label'>Femelles</div>
          </div>
          <div class='stat-item'>
            <span class='stat-number' id='youngCount'>0</span>
            <div class='stat-label'>Jeunes (2025)</div>
          </div>
        </div>

        <!-- Search and Filters -->
        <div class='search-filters fade-in'>
          <div class='search-row'>
            <div class='form-group' style='margin-bottom: 0;'>
              <input id='searchInput' onkeyup='filterPigeons()' placeholder='🔍 Rechercher par nom ou numéro de bague...' type='text'/>
            </div>
            <div class='form-group' style='margin-bottom: 0;'>
              <select id='countryFilter' onchange='filterPigeons()'>
                <option value=''>Tous les pays</option>
              </select>
            </div>
            <div class='form-group' style='margin-bottom: 0;'>
              <select id='breedFilter' onchange='filterPigeons()'>
                <option value=''>Toutes les races</option>
              </select>
            </div>
            <div class='form-group' style='margin-bottom: 0;'>
              <select id='colorFilter' onchange='filterPigeons()'>
                <option value=''>Toutes les couleurs</option>
              </select>
            </div>
            <button class='btn btn-info btn-small' onclick='clearFilters()'>🗑&#65039;</button>
          </div>
        </div>

        <div class='nav-buttons fade-in'>
          <button class='btn btn-success' onclick='showAddForm()'>&#10133; Ajouter Pigeon</button>
          <button class='btn btn-info' onclick='showPigeonsList()'>📋 Liste Pigeons</button>
          <button class='btn btn-warning' onclick='showRaceManager()'>🏆 Courses</button>
          <button class='btn' onclick='exportData()'>💾 Exporter</button>
          <button class='btn btn-info' onclick='generatePDF()'>📄 PDF</button>
        </div>

        <!-- Import/Export Section -->
        <div class='import-export fade-in'>
          <input accept='.json' class='file-input' id='fileInput' onchange='importData(event)' type='file'/>
          <label class='file-label' for='fileInput'>📁 Importer Données</label>
          <button class='btn btn-cancel btn-small' onclick='clearAllData()'>🗑&#65039; Effacer Tout</button>
        </div>

        <div class='hidden' id='addForm'>
          <h2 style='color: #667eea; text-align: center; margin-bottom: 30px;'>
            <span id='formTitle'>Ajouter un Nouveau Pigeon</span>
          </h2>

          <div class='form-row'>
            <div class='form-group'>
              <label>Numéro de bague (ex: 25-01741) :</label>
              <input id='ringNumber' placeholder='25-01741' type='text'/>
            </div>
            <div class='form-group'>
              <label>Pays d&#39;origine :</label>
              <select id='country'>
                <option value=''>Choisir un pays</option>
                <option value='🇲🇦'>🇲🇦 Maroc</option>
                <option value='🇫🇷'>🇫🇷 France</option>
                <option value='🇧🇪'>🇧🇪 Belgique</option>
                <option value='🇳🇱'>🇳🇱 Pays-Bas</option>
                <option value='🇩🇪'>🇩🇪 Allemagne</option>
                <option value='🇬🇧'>🇬🇧 Royaume-Uni</option>
                <option value='🇪🇸'>🇪🇸 Espagne</option>
                <option value='🇮🇹'>🇮🇹 Italie</option>
                <option value='🇺🇸'>🇺🇸 États-Unis</option>
                <option value='🇹🇷'>🇹🇷 Turquie</option>
                <option value='🇵🇱'>🇵🇱 Pologne</option>
                <option value='🇨🇿'>🇨🇿 République tchèque</option>
                <option value='🇦🇺'>🇦🇺 Australie</option>
                <option value='🇿🇦'>🇿🇦 Afrique du Sud</option>
                <option value='🇨🇳'>🇨🇳 Chine</option>
                <option value='🇯🇵'>🇯🇵 Japon</option>
              </select>
            </div>
          </div>

          <div class='form-row'>
            <div class='form-group'>
              <label>Nom du pigeon :</label>
              <input id='pigeonName' placeholder='Nom du pigeon' type='text'/>
            </div>
            <div class='form-group'>
              <label>Couleur de la bague :</label>
              <select id='ringColor'>
                <option value=''>Choisir une couleur</option>
                <option value='Rouge'>🔴 Rouge</option>
                <option value='Bleu'>🔵 Bleu</option>
                <option value='Vert'>🟢 Vert</option>
                <option value='Jaune'>🟡 Jaune</option>
                <option value='Orange'>🟠 Orange</option>
                <option value='Violet'>🟣 Violet</option>
                <option value='Noir'>&#9899; Noir</option>
                <option value='Blanc'>&#9898; Blanc</option>
                <option value='Argent'>🔘 Argent</option>
                <option value='Or'>🟡 Or</option>
                <option value='Rose'>🌸 Rose</option>
                <option value='Marron'>🟤 Marron</option>
              </select>
            </div>
          </div>
      
          <div class='form-row'>
            <div class='form-group'>
              <label>Couleur du pigeon :</label>
              <select id='pigeonColor'>
                <option value=''>Choisir une couleur</option>
                <option value='Bleu'>🔵 Bleu</option>
                <option value='Bleu barré'>🔵 Bleu barré</option>
                <option value='Bleu écaillé'>🔵 Bleu écaillé</option>
                <option value='Rouge'>🔴 Rouge</option>
                <option value='Rouge barré'>🔴 Rouge barré</option>
                <option value='Rouge écaillé'>🔴 Rouge écaillé</option>
                <option value='Noir'>&#9899; Noir</option>
                <option value='Brun'>🟤 Brun</option>
                <option value='Dun'>🟫 Dun</option>
                <option value='Blanc'>&#9898; Blanc</option>
                <option value='Gris'>&#9898; Gris</option>
                <option value='Gris foncé'>&#9899; Gris foncé</option>
                <option value='Fauve'>🟨 Fauve</option>
                <option value='Panaché'>🎨 Panaché</option>
                <option value='Pie'>🎨 Pie</option>
              </select>
            </div>
            <div class='form-group'>
              <label>Race du pigeon :</label>
              <select id='breed'>
                <option value=''>Choisir une race</option>
                <option value='Janssen'>🏆 Janssen</option>
                <option value='Van Reet'>🏆 Van Reet</option>
                <option value='Stichelbaut'>🏆 Stichelbaut</option>
                <option value='Gaby Vandenabeele'>🏆 Gaby Vandenabeele</option>
                <option value='Jos Thone'>🏆 Jos Thone</option>
                <option value='Marcel Aelbrecht'>🏆 Marcel Aelbrecht</option>
                <option value='Dirk Van Dyck'>🏆 Dirk Van Dyck</option>
                <option value='Koopman'>🏆 Koopman</option>
                <option value='Van Loon'>🏆 Van Loon</option>
                <option value='Hofken'>🏆 Hofken</option>
                <option value='Meulemans'>🏆 Meulemans</option>
                <option value='De Rauw-Sablon'>🏆 De Rauw-Sablon</option>
                <option value='Aarden'>🏆 Aarden</option>
                <option value='Catrysse'>🏆 Catrysse</option>
                <option value='Sion'>🏆 Sion</option>
                <option value='Flor Engels'>🏆 Flor Engels</option>
                <option value='Carlos Pereira'>🏆 Carlos Pereira</option>
                <option value='Leo Heremans'>🏆 Leo Heremans</option>
                <option value='Deweerdt'>🏆 Deweerdt</option>
                <option value='Van Der Wegen'>🏆 Van Der Wegen</option>
                <option value='Gerard Koopman'>🏆 Gerard Koopman</option>
                <option value='Autre'>&#10133; Autre</option>
              </select>
            </div>
          </div>

          <div class='form-row'>
            <div class='form-group'>
              <label>Propriétaire :</label>
              <input id='owner' placeholder='Nom du propriétaire' type='text'/>
            </div>
            <div class='form-group'>
              <label>Sexe :</label>
              <select id='gender'>
                <option value=''>Choisir le sexe</option>
                <option value='Mâle'>&#9794;&#65039; Mâle</option>
                <option value='Femelle'>&#9792;&#65039; Femelle</option>
              </select>
            </div>
          </div>
          
          <div class='form-row'>
            <div class='form-group'>
              <label>Bague du père :</label>
              <input id='fatherRing' placeholder='Numéro bague père' type='text'/>
            </div>
            <div class='form-group'>
              <label>Bague de la mère :</label>
              <input id='motherRing' placeholder='Numéro bague mère' type='text'/>
            </div>
          </div>

          <div class='form-group'>
            <label>Notes :</label>
            <textarea id='notes' placeholder='Informations supplémentaires sur le pigeon...' rows='4'/>
          </div>

          <div style='text-align: center; margin-top: 30px;'>
            <button class='btn btn-success' onclick='savePigeon()'>
              <span id='saveButtonText'>Enregistrer</span>
            </button>
            <button class='btn btn-cancel' onclick='showPigeonsList()'>Annuler</button>
          </div>
        </div>

        <!-- Race Manager -->
        <div class='hidden' id='raceManager'>
          <h2 style='color: #667eea; text-align: center; margin-bottom: 30px;'>🏆 Gestion des Courses</h2>
          
          <div class='form-row'>
            <div class='form-group'>
              <label>Nom de la course :</label>
              <input id='raceName' placeholder='Nom de la course' type='text'/>
            </div>
            <div class='form-group'>
              <label>Date :</label>
              <input id='raceDate' type='date'/>
            </div>
          </div>
          
          <div class='form-row'>
            <div class='form-group'>
              <label>Distance (km) :</label>
              <input id='raceDistance' min='1' placeholder='500' type='number'/>
            </div>
            <div class='form-group'>
              <label>Pigeon participant :</label>
              <select id='raceParticipant'>
                <option value=''>Sélectionner un pigeon</option>
              </select>
            </div>
          </div>
          
          <div class='form-row'>
            <div class='form-group'>
              <label>Position :</label>
              <input id='racePosition' min='1' placeholder='1' type='number'/>
            </div>
            <div class='form-group'>
              <label>Vitesse (m/min) :</label>
              <input id='raceSpeed' min='1' placeholder='1200' type='number'/>
            </div>
          </div>

          <div style='text-align: center; margin-top: 20px;'>
            <button class='btn btn-success' onclick='addRaceResult()'>Ajouter Résultat</button>
            <button class='btn btn-cancel' onclick='showPigeonsList()'>Retour</button>
          </div>
        </div>

        <div class='hidden' id='pigeonsList'>
          <div id='pigeonsContent'>
            <div class='empty-state'>
              Aucun pigeon enregistré. Cliquez sur &quot;Ajouter Pigeon&quot; pour commencer.
            </div>
          </div>
        </div>
      </div>
      
      <!-- Edit Modal -->
      <div class='modal' id='editModal'>
        <div class='modal-content'>
          <span class='close' onclick='closeEditModal()'>&#10005;</span>
          <h2>Modifier le Pigeon</h2>
          <div id='editFormContent'>
            <!-- Edit form will be populated here -->
          </div>
        </div>
      </div>
      
      <script type='text/javascript'>
      //<![CDATA[
        var currentUser = '';
        var pigeons = [];
        var raceResults = [];
        var editingPigeonId = null;
        var filteredPigeons = [];

        // Initialize with sample data
        pigeons.push({
          id: generateId(),
          ringNumber: '25-01741',
          country: '🇫🇷',
          name: 'Champion Alpha',
          ringColor: 'Rouge',
          pigeonColor: 'Bleu barré',
          breed: 'Janssen',
          owner: 'Pierre Dubois',
          gender: 'Mâle',
          fatherRing: '23-15432',
          motherRing: '24-98765',
          notes: 'Excellent pigeon de fond, très régulier dans les concours. Performance exceptionnelle sur les longues distances.',
          year: 2025,
          addedDate: new Date().toISOString()
        });

        pigeons.push({
          id: generateId(),
          ringNumber: '25-01802',
          country: '🇧🇪',
          name: 'Belle Étoile',
          ringColor: 'Bleu',
          pigeonColor: 'Rouge écaillé',
          breed: 'Gaby Vandenabeele',
          owner: 'Marie Laurent',
          gender: 'Femelle',
          fatherRing: '23-11234',
          motherRing: '24-55678',
          notes: 'Reproductrice exceptionnelle, mère de plusieurs champions.',
          year: 2025,
          addedDate: new Date().toISOString()
        });

        function generateId() {
          return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function loadData() {
          try {
            var saved = localStorage.getItem('pigeonData');
            if (saved) {
              var data = JSON.parse(saved);
              pigeons = data.pigeons || [];
              raceResults = data.raceResults || [];
              
              // Ensure all pigeons have IDs
              pigeons.forEach(function(pigeon) {
                if (!pigeon.id) {
                  pigeon.id = generateId();
                }
              });
              
              return true;
            }
          } catch (e) {
            console.log('Error loading data:', e);
          }
          return false;
        }

        function saveData() {
          try {
            var data = {
              pigeons: pigeons,
              raceResults: raceResults,
              lastSaved: new Date().toISOString()
            };
            localStorage.setItem('pigeonData', JSON.stringify(data));
            return true;
          } catch (e) {
            console.log('Error saving data:', e);
            return false;
          }
        }

        function login() {
          var username = document.getElementById('username').value.trim();
          var password = document.getElementById('password').value.trim();

          if (username && password) {
            currentUser = username;
            document.getElementById('currentUser').textContent = username;
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainApp').classList.remove('hidden');
            
            loadData();
            updateStatistics();
            populateFilters();
            showPigeonsList();
            
            setTimeout(function() {
              showNotification('Connexion réussie ! Bienvenue ' + username, 'success');
            }, 500);
          } else {
            showNotification('Veuillez saisir un nom d\'utilisateur et un mot de passe.', 'error');
          }
        }

        function logout() {
          if (confirm('Êtes-vous sûr de vouloir vous déconnecter ?')) {
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            currentUser = '';
            showNotification('Vous êtes déconnecté.', 'info');
          }
        }

        function toggleTheme() {
          var body = document.body;
          var themeToggle = document.querySelector('.theme-toggle');
          
          if (body.getAttribute('data-theme') === 'dark') {
            body.removeAttribute('data-theme');
            themeToggle.textContent = '🌙';
            localStorage.setItem('theme', 'light');
          } else {
            body.setAttribute('data-theme', 'dark');
            themeToggle.textContent = '☀️';
            localStorage.setItem('theme', 'dark');
          }
        }

        function updateStatistics() {
          var total = pigeons.length;
          var males = pigeons.filter(function(p) { return p.gender === 'Mâle'; }).length;
          var females = pigeons.filter(function(p) { return p.gender === 'Femelle'; }).length;
          var young = pigeons.filter(function(p) { return p.year === new Date().getFullYear(); }).length;

          document.getElementById('totalCount').textContent = total;
          document.getElementById('maleCount').textContent = males;
          document.getElementById('femaleCount').textContent = females;
          document.getElementById('youngCount').textContent = young;
        }

        function populateFilters() {
          var countries = new Set();
          var breeds = new Set();
          var colors = new Set();

          pigeons.forEach(function(pigeon) {
            if (pigeon.country) countries.add(pigeon.country);
            if (pigeon.breed) breeds.add(pigeon.breed);
            if (pigeon.pigeonColor) colors.add(pigeon.pigeonColor);
          });

          populateSelect('countryFilter', Array.from(countries));
          populateSelect('breedFilter', Array.from(breeds));
          populateSelect('colorFilter', Array.from(colors));
          populateSelect('raceParticipant', pigeons.map(function(p) { return p.ringNumber + ' - ' + p.name; }));
        }

        function populateSelect(selectId, options) {
          var select = document.getElementById(selectId);
          var currentValue = select.value;
          
          // Keep first option and clear others
          while (select.children.length > 1) {
            select.removeChild(select.lastChild);
          }

          options.sort().forEach(function(option) {
            var optionEl = document.createElement('option');
            optionEl.value = option;
            optionEl.textContent = option;
            select.appendChild(optionEl);
          });

          select.value = currentValue;
        }

        function filterPigeons() {
          var searchTerm = document.getElementById('searchInput').value.toLowerCase();
          var countryFilter = document.getElementById('countryFilter').value;
          var breedFilter = document.getElementById('breedFilter').value;
          var colorFilter = document.getElementById('colorFilter').value;

          filteredPigeons = pigeons.filter(function(pigeon) {
            var matchesSearch = !searchTerm || 
              pigeon.name.toLowerCase().includes(searchTerm) ||
              pigeon.ringNumber.toLowerCase().includes(searchTerm) ||
              (pigeon.owner && pigeon.owner.toLowerCase().includes(searchTerm));
            
            var matchesCountry = !countryFilter || pigeon.country === countryFilter;
            var matchesBreed = !breedFilter || pigeon.breed === breedFilter;
            var matchesColor = !colorFilter || pigeon.pigeonColor === colorFilter;

            return matchesSearch && matchesCountry && matchesBreed && matchesColor;
          });

          displayPigeons();
        }

        function clearFilters() {
          document.getElementById('searchInput').value = '';
          document.getElementById('countryFilter').selectedIndex = 0;
          document.getElementById('breedFilter').selectedIndex = 0;
          document.getElementById('colorFilter').selectedIndex = 0;
          filterPigeons();
        }

        function showAddForm() {
          editingPigeonId = null;
          document.getElementById('formTitle').textContent = 'Ajouter un Nouveau Pigeon';
          document.getElementById('saveButtonText').textContent = 'Enregistrer';
          
          document.getElementById('addForm').classList.remove('hidden');
          document.getElementById('addForm').classList.add('fade-in');
          document.getElementById('pigeonsList').classList.add('hidden');
          document.getElementById('raceManager').classList.add('hidden');
          
          clearAddForm();
          
          setTimeout(function() {
            document.getElementById('ringNumber').focus();
          }, 100);
        }

        function showRaceManager() {
          document.getElementById('raceManager').classList.remove('hidden');
          document.getElementById('raceManager').classList.add('fade-in');
          document.getElementById('addForm').classList.add('hidden');
          document.getElementById('pigeonsList').classList.add('hidden');
          
          populateFilters();
        }

        function showPigeonsList() {
          document.getElementById('addForm').classList.add('hidden');
          document.getElementById('raceManager').classList.add('hidden');
          document.getElementById('pigeonsList').classList.remove('hidden');
          document.getElementById('pigeonsList').classList.add('fade-in');
          
          updateStatistics();
          populateFilters();
          filterPigeons();
        }

        function savePigeon() {
          var ringNumber = document.getElementById('ringNumber').value.trim();
          var country = document.getElementById('country').value;
          var name = document.getElementById('pigeonName').value.trim();
          var ringColor = document.getElementById('ringColor').value;
          var pigeonColor = document.getElementById('pigeonColor').value;
          var breed = document.getElementById('breed').value;
          var owner = document.getElementById('owner').value.trim();
          var gender = document.getElementById('gender').value;
          var fatherRing = document.getElementById('fatherRing').value.trim();
          var motherRing = document.getElementById('motherRing').value.trim();
          var notes = document.getElementById('notes').value.trim();

          if (!ringNumber || !country) {
            showNotification('Veuillez remplir au moins le numéro de bague et le pays.', 'error');
            return;
          }

          // Check for duplicate ring numbers (except when editing)
          var existingPigeon = pigeons.find(function(p) { 
            return p.ringNumber === ringNumber && p.id !== editingPigeonId; 
          });
          
          if (existingPigeon) {
            showNotification('Ce numéro de bague existe déjà. Veuillez utiliser un autre numéro.', 'error');
            return;
          }

          var year = new Date().getFullYear();
          var ringMatch = ringNumber.match(/^(\d{2})-/);
          if (ringMatch) {
            var yearSuffix = parseInt(ringMatch[1]);
            year = yearSuffix + (yearSuffix > 50 ? 1900 : 2000);
          }

          var pigeon = {
            id: editingPigeonId || generateId(),
            ringNumber: ringNumber,
            country: country,
            name: name || 'Sans nom',
            ringColor: ringColor,
            pigeonColor: pigeonColor,
            breed: breed,
            owner: owner,
            gender: gender,
            fatherRing: fatherRing,
            motherRing: motherRing,
            notes: notes,
            year: year,
            addedDate: editingPigeonId ? 
              pigeons.find(function(p) { return p.id === editingPigeonId; }).addedDate : 
              new Date().toISOString()
          };

          if (editingPigeonId) {
            var index = pigeons.findIndex(function(p) { return p.id === editingPigeonId; });
            pigeons[index] = pigeon;
            showNotification('Pigeon modifié avec succès !', 'success');
          } else {
            pigeons.push(pigeon);
            showNotification('Pigeon ajouté avec succès !', 'success');
          }

          saveData();
          clearAddForm();
          showPigeonsList();
        }

        function editPigeon(pigeonId) {
          var pigeon = pigeons.find(function(p) { return p.id === pigeonId; });
          if (!pigeon) return;

          editingPigeonId = pigeonId;
          document.getElementById('formTitle').textContent = 'Modifier le Pigeon';
          document.getElementById('saveButtonText').textContent = 'Mettre à jour';

          // Populate form with pigeon data
          document.getElementById('ringNumber').value = pigeon.ringNumber;
          document.getElementById('country').value = pigeon.country;
          document.getElementById('pigeonName').value = pigeon.name;
          document.getElementById('ringColor').value = pigeon.ringColor || '';
          document.getElementById('pigeonColor').value = pigeon.pigeonColor || '';
          document.getElementById('breed').value = pigeon.breed || '';
          document.getElementById('owner').value = pigeon.owner || '';
          document.getElementById('gender').value = pigeon.gender || '';
          document.getElementById('fatherRing').value = pigeon.fatherRing || '';
          document.getElementById('motherRing').value = pigeon.motherRing || '';
          document.getElementById('notes').value = pigeon.notes || '';

          showAddForm();
        }

        function deletePigeon(pigeonId) {
          var pigeon = pigeons.find(function(p) { return p.id === pigeonId; });
          if (!pigeon) return;

          if (confirm('Êtes-vous sûr de vouloir supprimer le pigeon "' + pigeon.name + '" (' + pigeon.ringNumber + ') ?')) {
            pigeons = pigeons.filter(function(p) { return p.id !== pigeonId; });
            raceResults = raceResults.filter(function(r) { return r.pigeonId !== pigeonId; });
            
            saveData();
            showNotification('Pigeon supprimé avec succès.', 'info');
            showPigeonsList();
          }
        }

        function addRaceResult() {
          var raceName = document.getElementById('raceName').value.trim();
          var raceDate = document.getElementById('raceDate').value;
          var distance = document.getElementById('raceDistance').value;
          var participantText = document.getElementById('raceParticipant').value;
          var position = document.getElementById('racePosition').value;
          var speed = document.getElementById('raceSpeed').value;

          if (!raceName || !raceDate || !participantText || !position) {
            showNotification('Veuillez remplir tous les champs obligatoires.', 'error');
            return;
          }

          var ringNumber = participantText.split(' - ')[0];
          var pigeon = pigeons.find(function(p) { return p.ringNumber === ringNumber; });
          
          if (!pigeon) {
            showNotification('Pigeon non trouvé.', 'error');
            return;
          }

          var result = {
            id: generateId(),
            pigeonId: pigeon.id,
            raceName: raceName,
            raceDate: raceDate,
            distance: parseInt(distance) || 0,
            position: parseInt(position),
            speed: parseInt(speed) || 0,
            addedDate: new Date().toISOString()
          };

          raceResults.push(result);
          saveData();
          
          showNotification('Résultat de course ajouté avec succès !', 'success');
          
          // Clear form
          document.getElementById('raceName').value = '';
          document.getElementById('raceDate').value = '';
          document.getElementById('raceDistance').value = '';
          document.getElementById('raceParticipant').selectedIndex = 0;
          document.getElementById('racePosition').value = '';
          document.getElementById('raceSpeed').value = '';
        }

        function clearAddForm() {
          var fields = ['ringNumber', 'pigeonName', 'owner', 'fatherRing', 'motherRing', 'notes'];
          for (var i = 0; i < fields.length; i++) {
            document.getElementById(fields[i]).value = '';
          }
          
          var selects = ['country', 'ringColor', 'pigeonColor', 'breed', 'gender'];
          for (var j = 0; j < selects.length; j++) {
            document.getElementById(selects[j]).selectedIndex = 0;
          }
        }

        function displayPigeons() {
          var container = document.getElementById('pigeonsContent');
          var pigeonsToShow = filteredPigeons.length > 0 || 
            document.getElementById('searchInput').value || 
            document.getElementById('countryFilter').value ||
            document.getElementById('breedFilter').value ||
            document.getElementById('colorFilter').value ? 
            filteredPigeons : pigeons;

          if (pigeonsToShow.length === 0) {
            if (pigeons.length === 0) {
              container.innerHTML = '<div class="empty-state">Aucun pigeon enregistré. Cliquez sur "Ajouter Pigeon" pour commencer.</div>';
            } else {
              container.innerHTML = '<div class="empty-state">Aucun pigeon ne correspond aux critères de recherche.</div>';
            }
            return;
          }

          var helpMessage = '<div class="click-hint">💡 Cliquez sur une carte pour voir plus de détails</div>';

          // Group pigeons by year
          var pigeonsByYear = {};
          for (var i = 0; i < pigeonsToShow.length; i++) {
            var pigeon = pigeonsToShow[i];
            if (!pigeonsByYear[pigeon.year]) {
              pigeonsByYear[pigeon.year] = [];
            }
            pigeonsByYear[pigeon.year].push(pigeon);
          }

          var years = Object.keys(pigeonsByYear).sort(function(a, b) { return b - a; });
          var html = '';

          for (var y = 0; y < years.length; y++) {
            var year = years[y];
            var yearPigeons = pigeonsByYear[year];

            html += '<div class="year-section fade-in">';
            html += '<div class="year-title">Année ' + year + ' (' + yearPigeons.length + ' pigeon' + (yearPigeons.length > 1 ? 's' : '') + ')</div>';
            html += '<div class="pigeon-grid">';

            for (var p = 0; p < yearPigeons.length; p++) {
              var pigeon = yearPigeons[p];
              var pigeonRaces = raceResults.filter(function(r) { return r.pigeonId === pigeon.id; });

              html += '<div class="pigeon-card" onclick="togglePigeonDetails(this)">';
              html += '<div class="pigeon-number">' + escapeHtml(pigeon.ringNumber) + '</div>';
              html += '<div class="expand-arrow">▼</div>';
              html += '<div class="pigeon-country">' + pigeon.country + '</div>';
              html += '<div class="pigeon-name">' + escapeHtml(pigeon.name) + '</div>';
              
              html += '<div class="pigeon-summary">';
              html += '<span>' + (pigeon.breed || 'Race non spécifiée') + '</span>';
              html += '<span>' + (pigeon.gender || '') + '</span>';
              html += '</div>';
              
              if (pigeon.breed) {
                html += '<div class="race-badge">🏆 ' + pigeon.breed + '</div>';
              }
              
              html += '<div class="pigeon-details">';
              html += '<div class="detail-row"><span class="detail-label">Couleur bague :</span><span class="detail-value">' + (pigeon.ringColor || 'Non spécifiée') + '</span></div>';
              html += '<div class="detail-row"><span class="detail-label">Couleur pigeon :</span><span class="detail-value">' + (pigeon.pigeonColor || 'Non spécifiée') + '</span></div>';
              html += '<div class="detail-row"><span class="detail-label">Race :</span><span class="detail-value">' + (pigeon.breed || 'Non spécifiée') + '</span></div>';
              html += '<div class="detail-row"><span class="detail-label">Propriétaire :</span><span class="detail-value">' + escapeHtml(pigeon.owner || 'Non spécifié') + '</span></div>';
              html += '<div class="detail-row"><span class="detail-label">Sexe :</span><span class="detail-value">' + (pigeon.gender || 'Non spécifié') + '</span></div>';
              html += '<div class="detail-row"><span class="detail-label">Père :</span><span class="detail-value">' + escapeHtml(pigeon.fatherRing || 'Non spécifié') + '</span></div>';
              html += '<div class="detail-row"><span class="detail-label">Mère :</span><span class="detail-value">' + escapeHtml(pigeon.motherRing || 'Non spécifiée') + '</span></div>';

              if (pigeonRaces.length > 0) {
                html += '<div class="detail-row"><span class="detail-label">Courses :</span><span class="detail-value">' + pigeonRaces.length + ' résultat(s)</span></div>';
              }

              if (pigeon.notes) {
                html += '<div class="notes-box"><strong>Notes :</strong><br>' + escapeHtml(pigeon.notes) + '</div>';
              }

              html += '<div class="card-actions">';
              html += '<button class="btn btn-warning btn-small" onclick="event.stopPropagation(); editPigeon(\'' + pigeon.id + '\')">✏️ Modifier</button>';
              html += '<button class="btn btn-danger btn-small" onclick="event.stopPropagation(); deletePigeon(\'' + pigeon.id + '\')">🗑️ Supprimer</button>';
              html += '</div>';

              html += '</div>';
              html += '</div>';
            }

            html += '</div>';
            html += '</div>';
          }

          container.innerHTML = helpMessage + html;
        }

        function togglePigeonDetails(card) {
          var details = card.querySelector('.pigeon-details');
          var arrow = card.querySelector('.expand-arrow');
          
          if (details.classList.contains('expanded')) {
            details.classList.remove('expanded');
            arrow.classList.remove('rotated');
          } else {
            details.classList.add('expanded');
            arrow.classList.add('rotated');
          }
        }

        function closeEditModal() {
          document.getElementById('editModal').style.display = 'none';
        }

        function escapeHtml(text) {
          if (!text) return '';
          var div = document.createElement('div');
          div.textContent = text;
          return div.innerHTML;
        }

        function exportData() {
          var data = {
            utilisateur: currentUser,
            pigeons: pigeons,
            resultats: raceResults,
            dateExport: new Date().toISOString(),
            totalPigeons: pigeons.length,
            version: '3.0'
          };

          var dataStr = JSON.stringify(data, null, 2);
          var element = document.createElement('a');
          element.setAttribute('href', 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr));
          element.setAttribute('download', 'colombier_sauvegarde_' + new Date().toISOString().split('T')[0] + '.json');
          element.style.display = 'none';
          document.body.appendChild(element);
          element.click();
          document.body.removeChild(element);

          showNotification('Données exportées avec succès !\nNombre de pigeons : ' + pigeons.length, 'success');
        }

        function importData(event) {
          var file = event.target.files[0];
          if (!file) return;

          var reader = new FileReader();
          reader.onload = function(e) {
            try {
              var data = JSON.parse(e.target.result);
              
              if (data.pigeons && Array.isArray(data.pigeons)) {
                if (confirm('Voulez-vous remplacer toutes les données existantes ? Cette action est irréversible.')) {
                  pigeons = data.pigeons;
                  raceResults = data.resultats || [];
                  
                  // Ensure all pigeons have IDs
                  pigeons.forEach(function(pigeon) {
                    if (!pigeon.id) {
                      pigeon.id = generateId();
                    }
                  });

                  saveData();
                  updateStatistics();
                  populateFilters();
                  showPigeonsList();
                  showNotification('Données importées avec succès ! ' + pigeons.length + ' pigeons chargés.', 'success');
                }
              } else {
                showNotification('Format de fichier invalide.', 'error');
              }
            } catch (error) {
              showNotification('Erreur lors de l\'importation du fichier.', 'error');
            }
          };
          reader.readAsText(file);
          
          // Reset file input
          event.target.value = '';
        }

        function clearAllData() {
          if (confirm('Êtes-vous sûr de vouloir supprimer TOUTES les données ? Cette action est irréversible.')) {
            if (confirm('Dernière confirmation : Toutes les données seront perdues définitivement !')) {
              pigeons = [];
              raceResults = [];
              saveData();
              updateStatistics();
              populateFilters();
              showPigeonsList();
              showNotification('Toutes les données ont été supprimées.', 'info');
            }
          }
        }

        function generatePDF() {
          var printContent = '';
          printContent += '<h1 style="text-align: center; color: #667eea;">📋 Liste des Pigeons</h1>';
          printContent += '<p style="text-align: center; margin-bottom: 30px;">Généré le : ' + new Date().toLocaleDateString('fr-FR') + '</p>';
          
          printContent += '<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">';
          printContent += '<div style="text-align: center; padding: 15px; background: #f8f9fa; border-radius: 8px;"><strong>Total:</strong> ' + pigeons.length + '</div>';
          printContent += '<div style="text-align: center; padding: 15px; background: #e3f2fd; border-radius: 8px;"><strong>Mâles:</strong> ' + pigeons.filter(function(p) { return p.gender === 'Mâle'; }).length + '</div>';
          printContent += '<div style="text-align: center; padding: 15px; background: #fce4ec; border-radius: 8px;"><strong>Femelles:</strong> ' + pigeons.filter(function(p) { return p.gender === 'Femelle'; }).length + '</div>';
          printContent += '<div style="text-align: center; padding: 15px; background: #e8f5e8; border-radius: 8px;"><strong>Jeunes:</strong> ' + pigeons.filter(function(p) { return p.year === new Date().getFullYear(); }).length + '</div>';
          printContent += '</div>';

          var pigeonsByYear = {};
          pigeons.forEach(function(pigeon) {
            if (!pigeonsByYear[pigeon.year]) {
              pigeonsByYear[pigeon.year] = [];
            }
            pigeonsByYear[pigeon.year].push(pigeon);
          });

          var years = Object.keys(pigeonsByYear).sort(function(a, b) { return b - a; });

          years.forEach(function(year) {
            printContent += '<h2 style="color: #667eea; border-bottom: 2px solid #667eea; padding-bottom: 10px;">Année ' + year + ' (' + pigeonsByYear[year].length + ' pigeons)</h2>';
            
            pigeonsByYear[year].forEach(function(pigeon) {
              printContent += '<div style="border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 8px; page-break-inside: avoid;">';
              printContent += '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">';
              printContent += '<h3 style="color: #667eea; margin: 0;">' + escapeHtml(pigeon.ringNumber) + ' - ' + escapeHtml(pigeon.name) + '</h3>';
              printContent += '<span style="font-size: 1.5em;">' + pigeon.country + '</span>';
              printContent += '</div>';
              
              printContent += '<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 14px;">';
              printContent += '<div><strong>Race:</strong> ' + (pigeon.breed || 'Non spécifiée') + '</div>';
              printContent += '<div><strong>Sexe:</strong> ' + (pigeon.gender || 'Non spécifié') + '</div>';
              printContent += '<div><strong>Couleur:</strong> ' + (pigeon.pigeonColor || 'Non spécifiée') + '</div>';
              printContent += '<div><strong>Propriétaire:</strong> ' + escapeHtml(pigeon.owner || 'Non spécifié') + '</div>';
              printContent += '<div><strong>Père:</strong> ' + escapeHtml(pigeon.fatherRing || 'Non spécifié') + '</div>';
              printContent += '<div><strong>Mère:</strong> ' + escapeHtml(pigeon.motherRing || 'Non spécifiée') + '</div>';
              printContent += '</div>';
              
              if (pigeon.notes) {
                printContent += '<div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-left: 4px solid #667eea; font-style: italic;"><strong>Notes:</strong> ' + escapeHtml(pigeon.notes) + '</div>';
              }
              
              printContent += '</div>';
            });
          });

          var printWindow = window.open('', '_blank');
          printWindow.document.write('<html><head><title>Liste des Pigeons</title>');
          printWindow.document.write('<style>body { font-family: Arial, sans-serif; margin: 20px; } @media print { body { margin: 0; } }</style>');
          printWindow.document.write('</head><body>' + printContent + '</body></html>');
          printWindow.document.close();
          printWindow.print();
        }

        function showNotification(message, type) {
          var notification = document.createElement('div');
          notification.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 1000; padding: 15px 20px; border-radius: 8px; color: white; font-weight: 600; max-width: 300px; word-wrap: break-word; animation: slideIn 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
          
          switch(type) {
            case 'success':
              notification.style.background = 'linear-gradient(135deg, #28a745, #20c997)';
              break;
            case 'error':
              notification.style.background = 'linear-gradient(135deg, #dc3545, #fd7e14)';
              break;
            case 'info':
              notification.style.background = 'linear-gradient(135deg, #17a2b8, #6f42c1)';
              break;
            default:
              notification.style.background = 'linear-gradient(135deg, #6c757d, #495057)';
          }
          
          notification.textContent = message;
          document.body.appendChild(notification);
          
          setTimeout(function() {
            notification.style.animation = 'fadeOut 0.3s ease';
            setTimeout(function() {
              if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
              }
            }, 300);
          }, 3000);
        }

        document.addEventListener('DOMContentLoaded', function() {
          // Load theme
          var savedTheme = localStorage.getItem('theme');
          if (savedTheme === 'dark') {
            document.body.setAttribute('data-theme', 'dark');
            document.querySelector('.theme-toggle').textContent = '☀️';
          }

          // Login form keyboard handling
          var loginInputs = ['username', 'password'];
          for (var i = 0; i < loginInputs.length; i++) {
            var input = document.getElementById(loginInputs[i]);
            if (input) {
              input.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                  login();
                }
              });
            }
          }
          
          // iOS zoom prevention
          if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            var viewportTag = document.querySelector('meta[name="viewport"]');
            if (viewportTag) {
              viewportTag.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no';
            }
          }

          // Auto-save every 5 minutes
          setInterval(function() {
            if (currentUser && pigeons.length > 0) {
              saveData();
            }
          }, 300000);
        });

      //]]>
      </script>

      <b:section class='main' id='main' maxwidgets='1' showaddelement='yes'>
        <b:widget id='Blog1' locked='false' title='Messages' type='Blog' version='1'>
          <b:widget-settings>
            <b:widget-setting name='showDateHeader'>true</b:widget-setting>
            <b:widget-setting name='style.textcolor'>#ffffff</b:widget-setting>
            <b:widget-setting name='showShareButtons'>true</b:widget-setting>
            <b:widget-setting name='authorLabel'>Par</b:widget-setting>
            <b:widget-setting name='showCommentLink'>true</b:widget-setting>
            <b:widget-setting name='style.urlcolor'>#ffffff</b:widget-setting>
            <b:widget-setting name='showAuthor'>false</b:widget-setting>
            <b:widget-setting name='style.linkcolor'>#ffffff</b:widget-setting>
            <b:widget-setting name='style.unittype'>TextAndImage</b:widget-setting>
            <b:widget-setting name='style.bgcolor'>#ffffff</b:widget-setting>
            <b:widget-setting name='reactionsLabel'/>
            <b:widget-setting name='showAuthorProfile'>false</b:widget-setting>
            <b:widget-setting name='style.layout'>1x1</b:widget-setting>
            <b:widget-setting name='showLabels'>true</b:widget-setting>
            <b:widget-setting name='showLocation'>true</b:widget-setting>
            <b:widget-setting name='showTimestamp'>true</b:widget-setting>
            <b:widget-setting name='postsPerAd'>3</b:widget-setting>
            <b:widget-setting name='showBacklinks'>false</b:widget-setting>
            <b:widget-setting name='style.bordercolor'>#ffffff</b:widget-setting>
            <b:widget-setting name='showInlineAds'>true</b:widget-setting>
            <b:widget-setting name='showReactions'>false</b:widget-setting>
          </b:widget-settings>
          <b:includable id='main' var='top'>
            <!-- Contenu masqué par défaut -->
          </b:includable>
          <b:includable id='backlinkDeleteIcon' var='backlink'/>
          <b:includable id='backlinks' var='post'/>
          <b:includable id='comment-form' var='post'>
  <div class='comment-form'>
    <a name='comment-form'/>
    <b:if cond='data:mobile'>
      <h4 id='comment-post-message'>
        <a expr:id='data:widget.instanceId + &quot;_comment-editor-toggle-link&quot;' href='javascript:void(0)'><data:postCommentMsg/></a></h4>
      <p><data:blogCommentMessage/></p>
      <data:blogTeamBlogMessage/>
      <a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/>
      <iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' expr:height='data:cmtIframeInitialHeight' frameborder='0' id='comment-editor' name='comment-editor' src='' style='display: none' width='100%'/>
    <b:else/>
      <h4 id='comment-post-message'><data:postCommentMsg/></h4>
      <p><data:blogCommentMessage/></p>
      <data:blogTeamBlogMessage/>
      <a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/>
      <iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' expr:height='data:cmtIframeInitialHeight' frameborder='0' id='comment-editor' name='comment-editor' src='' width='100%'/>
    </b:if>
    <data:post.cmtfpIframe/>
    <script type='text/javascript'>
      BLOG_CMT_createIframe(&#39;<data:post.appRpcRelayPath/>&#39;);
    </script>
  </div>
</b:includable>
          <b:includable id='commentDeleteIcon' var='comment'>
  <span expr:class='&quot;item-control &quot; + data:comment.adminClass'>
    <b:if cond='data:showCmtPopup'>
      <div class='goog-toggle-button'>
        <div class='goog-inline-block comment-action-icon'/>
      </div>
    <b:else/>
      <a class='comment-delete' expr:href='data:comment.deleteUrl' expr:title='data:top.deleteCommentMsg'>
        <img src='https://resources.blogblog.com/img/icon_delete13.gif'/>
      </a>
    </b:if>
  </span>
</b:includable>
          <b:includable id='comment_count_picker' var='post'>
  <a class='comment-link' expr:href='data:post.addCommentUrl' expr:onclick='data:post.addCommentOnclick'>
    <data:post.commentLabelFull/>:
  </a>
</b:includable>
          <b:includable id='comment_picker' var='post'>
  <b:if cond='data:post.showThreadedComments'>
    <b:include data='post' name='threaded_comments'/>
  <b:else/>
    <b:include data='post' name='comments'/>
  </b:if>
</b:includable>
          <b:includable id='comments' var='post'>
  <div class='comments' id='comments'>
    <a name='comments'/>
    <b:if cond='data:post.allowComments'>
      <h4><data:post.commentLabelFull/>:</h4>

      <b:if cond='data:post.commentPagingRequired'>
        <span class='paging-control-container'>
          <b:if cond='data:post.hasOlderLinks'>
            <a expr:class='data:post.oldLinkClass' expr:href='data:post.oldestLinkUrl'><data:post.oldestLinkText/></a>
              &#160;
            <a expr:class='data:post.oldLinkClass' expr:href='data:post.olderLinkUrl'><data:post.olderLinkText/></a>
              &#160;
          </b:if>

          <data:post.commentRangeText/>

          <b:if cond='data:post.hasNewerLinks'>
            &#160;
            <a expr:class='data:post.newLinkClass' expr:href='data:post.newerLinkUrl'><data:post.newerLinkText/></a>
            &#160;
            <a expr:class='data:post.newLinkClass' expr:href='data:post.newestLinkUrl'><data:post.newestLinkText/></a>
          </b:if>
        </span>
      </b:if>

      <div expr:id='data:widget.instanceId + &quot;_comments-block-wrapper&quot;'>
        <dl expr:class='data:post.avatarIndentClass' id='comments-block'>
          <b:loop values='data:post.comments' var='comment'>
            <dt expr:class='&quot;comment-author &quot; + data:comment.authorClass' expr:id='data:comment.anchorName'>
              <b:if cond='data:comment.favicon'>
                <img expr:src='data:comment.favicon' height='16px' style='margin-bottom:-2px;' width='16px'/>
              </b:if>
              <a expr:name='data:comment.anchorName'/>
              <b:if cond='data:blog.enabledCommentProfileImages'>
                <data:comment.authorAvatarImage/>
              </b:if>
              <b:if cond='data:comment.authorUrl'>
                <a expr:href='data:comment.authorUrl' rel='nofollow'><data:comment.author/></a>
              <b:else/>
                <data:comment.author/>
              </b:if>
              <data:commentPostedByMsg/>
            </dt>
            <dd class='comment-body' expr:id='data:widget.instanceId + data:comment.cmtBodyIdPostfix'>
              <b:if cond='data:comment.isDeleted'>
                <span class='deleted-comment'><data:comment.body/></span>
              <b:else/>
                <p>
                  <data:comment.body/>
                </p>
              </b:if>
            </dd>
            <dd class='comment-footer'>
              <span class='comment-timestamp'>
                <a expr:href='data:comment.url' title='comment permalink'>
                  <data:comment.timestamp/>
                </a>
                <b:include data='comment' name='commentDeleteIcon'/>
              </span>
            </dd>
          </b:loop>
        </dl>
      </div>

      <b:if cond='data:post.commentPagingRequired'>
        <span class='paging-control-container'>
          <a expr:class='data:post.oldLinkClass' expr:href='data:post.oldestLinkUrl'>
            <data:post.oldestLinkText/>
          </a>
          <a expr:class='data:post.oldLinkClass' expr:href='data:post.olderLinkUrl'>
            <data:post.olderLinkText/>
          </a>
          &#160;
          <data:post.commentRangeText/>
          &#160;
          <a expr:class='data:post.newLinkClass' expr:href='data:post.newerLinkUrl'>
            <data:post.newerLinkText/>
          </a>
          <a expr:class='data:post.newLinkClass' expr:href='data:post.newestLinkUrl'>
            <data:post.newestLinkText/>
          </a>
        </span>
      </b:if>

      <p class='comment-footer'>
        <b:if cond='data:post.embedCommentForm'>
          <b:if cond='data:post.allowNewComments'>
            <b:include data='post' name='comment-form'/>
          <b:else/>
            <data:post.noNewCommentsText/>
          </b:if>
        <b:elseif cond='data:post.allowComments'/>
          <a expr:href='data:post.addCommentUrl' expr:onclick='data:post.addCommentOnclick'><data:postCommentMsg/></a>
        </b:if>
      </p>
    </b:if>
    <b:if cond='data:showCmtPopup'>
      <div id='comment-popup'>
        <iframe allowtransparency='true' frameborder='0' id='comment-actions' name='comment-actions' scrolling='no'>
        </iframe>
      </div>
    </b:if>

  </div>
</b:includable>
          <b:includable id='feedLinks'>
  <b:if cond='data:blog.pageType != &quot;item&quot;'> <!-- Blog feed links -->
    <b:if cond='data:feedLinks'>
      <div class='blog-feeds'>
        <b:include data='feedLinks' name='feedLinksBody'/>
      </div>
    </b:if>

  <b:else/> <!--Post feed links -->
    <div class='post-feeds'>
      <b:loop values='data:posts' var='post'>
        <b:include cond='data:post.allowComments and data:post.feedLinks' data='post.feedLinks' name='feedLinksBody'/>
      </b:loop>
    </div>
  </b:if>
</b:includable>
          <b:includable id='feedLinksBody' var='links'>
  <div class='feed-links'>
  <data:feedLinksMsg/>
  <b:loop values='data:links' var='f'>
     <a class='feed-link' expr:href='data:f.url' expr:type='data:f.mimeType' target='_blank'><data:f.name/> (<data:f.feedType/>)</a>
  </b:loop>
  </div>
</b:includable>
          <b:includable id='iframe_comments' var='post'>
  <!-- G+ comments, no longer available. The includable is retained for backwards-compatibility. -->
</b:includable>
          <b:includable id='mobile-index-post' var='post'>
  <div class='mobile-date-outer date-outer'>
    <b:if cond='data:post.dateHeader'>
      <div class='date-header'>
        <span><data:post.dateHeader/></span>
      </div>
    </b:if>

    <div class='mobile-post-outer'>
      <a expr:href='data:post.url'>
        <h3 class='mobile-index-title entry-title' itemprop='name'>
          <data:post.title/>
        </h3>

        <div class='mobile-index-arrow'>&amp;rsaquo;</div>

        <div class='mobile-index-contents'>
          <b:if cond='data:post.thumbnailUrl'>
            <div class='mobile-index-thumbnail'>
              <div class='Image'>
                <img expr:src='data:post.thumbnailUrl'/>
              </div>
            </div>
          </b:if>

          <div class='post-body'>
            <b:if cond='data:post.snippet'><data:post.snippet/></b:if>
          </div>
        </div>

        <div style='clear: both;'/>
      </a>

      <div class='mobile-index-comment'>
        <b:include cond='data:blog.pageType != &quot;static_page&quot;                          and data:post.allowComments                          and data:post.numComments != 0' data='post' name='comment_count_picker'/>
      </div>
    </div>
  </div>
</b:includable>
          <b:includable id='mobile-main' var='top'>
    <!-- posts -->
    <div class='blog-posts hfeed'>

      <b:include data='top' name='status-message'/>

      <b:if cond='data:blog.pageType == &quot;index&quot;'>
        <b:loop values='data:posts' var='post'>
          <b:include data='post' name='mobile-index-post'/>
        </b:loop>
      <b:else/>
        <b:loop values='data:posts' var='post'>
          <b:include data='post' name='mobile-post'/>
        </b:loop>
      </b:if>
    </div>

   <b:include name='mobile-nextprev'/>
</b:includable>
          <b:includable id='mobile-nextprev'>
  <div class='blog-pager' id='blog-pager'>
    <b:if cond='data:newerPageUrl'>
      <div class='mobile-link-button' id='blog-pager-newer-link'>
      <a class='blog-pager-newer-link' expr:href='data:newerPageUrl' expr:id='data:widget.instanceId + &quot;_blog-pager-newer-link&quot;' expr:title='data:newerPageTitle'>&amp;lsaquo;</a>
      </div>
    </b:if>

    <b:if cond='data:olderPageUrl'>
      <div class='mobile-link-button' id='blog-pager-older-link'>
      <a class='blog-pager-older-link' expr:href='data:olderPageUrl' expr:id='data:widget.instanceId + &quot;_blog-pager-older-link&quot;' expr:title='data:olderPageTitle'>&amp;rsaquo;</a>
      </div>
    </b:if>

    <div class='mobile-link-button' id='blog-pager-home-link'>
    <a class='home-link' expr:href='data:blog.homepageUrl'><data:homeMsg/></a>
    </div>

    <div class='mobile-desktop-link'>
      <a class='home-link' expr:href='data:desktopLinkUrl'><data:desktopLinkMsg/></a>
    </div>

  </div>
  <div class='clear'/>
</b:includable>
          <b:includable id='mobile-post' var='post'>
  <div class='date-outer'>
    <b:if cond='data:post.dateHeader'>
      <h2 class='date-header'><span><data:post.dateHeader/></span></h2>
    </b:if>
    <div class='date-posts'>
      <div class='post-outer'>

        <div class='post hentry uncustomized-post-template' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
          <b:if cond='data:post.thumbnailUrl'>
            <meta expr:content='data:post.thumbnailUrl' itemprop='image_url'/>
          </b:if>
          <meta expr:content='data:blog.blogId' itemprop='blogId'/>
          <meta expr:content='data:post.id' itemprop='postId'/>

          <a expr:name='data:post.id'/>
          <b:if cond='data:post.title'>
            <h3 class='post-title entry-title' itemprop='name'>
              <b:if cond='data:post.link'>
                <a expr:href='data:post.link'><data:post.title/></a>
              <b:elseif cond='data:post.url and data:blog.url != data:post.url'/>
                <a expr:href='data:post.url'><data:post.title/></a>
              <b:else/>
                <data:post.title/>
              </b:if>
            </h3>
          </b:if>

          <div class='post-header'>
            <div class='post-header-line-1'/>
          </div>

          <div class='post-body entry-content' expr:id='&quot;post-body-&quot; + data:post.id' itemprop='articleBody'>
            <data:post.body/>
            <div style='clear: both;'/> <!-- clear for photos floats -->
          </div>

          <div class='post-footer'>
            <div class='post-footer-line post-footer-line-1'>
              <span class='post-author vcard'>
                <b:if cond='data:top.showAuthor'>
                  <b:if cond='data:post.authorProfileUrl'>
                    <span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
                      <meta expr:content='data:post.authorProfileUrl' itemprop='url'/>
                      <a expr:href='data:post.authorProfileUrl' rel='author' title='author profile'>
                        <span itemprop='name'><data:post.author/></span>
                      </a>
                    </span>
                  <b:else/>
                    <span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
                      <span itemprop='name'><data:post.author/></span>
                    </span>
                  </b:if>
                </b:if>
              </span>

              <span class='post-timestamp'>
                <b:if cond='data:top.showTimestamp'>
                  <data:top.timestampLabel/>
                  <b:if cond='data:post.url'>
                    <meta expr:content='data:post.url.canonical' itemprop='url'/>
                    <a class='timestamp-link' expr:href='data:post.url' rel='bookmark' title='permanent link'><abbr class='published' expr:title='data:post.timestampISO8601' itemprop='datePublished'><data:post.timestamp/></abbr></a>
                  </b:if>
                </b:if>
              </span>

              <span class='post-comment-link'>
                <b:include cond='data:blog.pageType not in {&quot;item&quot;,&quot;static_page&quot;}                                  and data:post.allowComments' data='post' name='comment_count_picker'/>
              </span>
            </div>

            <div class='post-footer-line post-footer-line-2'>
              <b:if cond='data:top.showMobileShare'>
                <div class='mobile-link-button goog-inline-block' id='mobile-share-button'>
                  <a href='javascript:void(0);'><data:shareMsg/></a>
                </div>
              </b:if>
            </div>

          </div>
        </div>

        <b:include cond='data:blog.pageType in {&quot;static_page&quot;,&quot;item&quot;}' data='post' name='comment_picker'/>
      </div>
    </div>
  </div>
</b:includable>
          <b:includable id='nextprev'>
  <div class='blog-pager' id='blog-pager'>
    <b:if cond='data:newerPageUrl'>
      <span id='blog-pager-newer-link'>
      <a class='blog-pager-newer-link' expr:href='data:newerPageUrl' expr:id='data:widget.instanceId + &quot;_blog-pager-newer-link&quot;' expr:title='data:newerPageTitle'><data:newerPageTitle/></a>
      </span>
    </b:if>

    <b:if cond='data:olderPageUrl'>
      <span id='blog-pager-older-link'>
      <a class='blog-pager-older-link' expr:href='data:olderPageUrl' expr:id='data:widget.instanceId + &quot;_blog-pager-older-link&quot;' expr:title='data:olderPageTitle'><data:olderPageTitle/></a>
      </span>
    </b:if>

    <a class='home-link' expr:href='data:blog.homepageUrl'><data:homeMsg/></a>

    <b:if cond='data:mobileLinkUrl'>
      <div class='blog-mobile-link'>
        <a expr:href='data:mobileLinkUrl'><data:mobileLinkMsg/></a>
      </div>
    </b:if>

  </div>
  <div class='clear'/>
</b:includable>
          <b:includable id='post' var='post'>
  <div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
    <b:if cond='data:post.firstImageUrl'>
      <meta expr:content='data:post.firstImageUrl' itemprop='image_url'/>
    </b:if>
    <meta expr:content='data:blog.blogId' itemprop='blogId'/>
    <meta expr:content='data:post.id' itemprop='postId'/>

    <a expr:name='data:post.id'/>
    <b:if cond='data:post.title'>
      <h3 class='post-title entry-title' itemprop='name'>
      <b:if cond='data:post.link or (data:post.url and data:blog.url != data:post.url)'>
        <a expr:href='data:post.link ? data:post.link : data:post.url'><data:post.title/></a>
      <b:else/>
        <data:post.title/>
      </b:if>
      </h3>
    </b:if>

    <div class='post-header'>
    <div class='post-header-line-1'/>
    </div>

    <!-- Then use the post body as the schema.org description, for good G+/FB snippeting. -->
    <div class='post-body entry-content' expr:id='&quot;post-body-&quot; + data:post.id' expr:itemprop='(data:blog.metaDescription ? &quot;&quot; : &quot;description &quot;) + &quot;articleBody&quot;'>
      <data:post.body/>
      <div style='clear: both;'/> <!-- clear for photos floats -->
    </div>

    <b:if cond='data:post.hasJumpLink'>
      <div class='jump-link'>
        <a expr:href='data:post.url + &quot;#more&quot;' expr:title='data:post.title'><data:post.jumpText/></a>
      </div>
    </b:if>

    <div class='post-footer'>
    <div class='post-footer-line post-footer-line-1'>
      <span class='post-author vcard'>
        <b:if cond='data:top.showAuthor'>
          <data:top.authorLabel/>
            <b:if cond='data:post.authorProfileUrl'>
              <span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
                <meta expr:content='data:post.authorProfileUrl' itemprop='url'/>
                <a class='g-profile' expr:href='data:post.authorProfileUrl' rel='author' title='author profile'>
                  <span itemprop='name'><data:post.author/></span>
                </a>
              </span>
            <b:else/>
              <span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
                <span itemprop='name'><data:post.author/></span>
              </span>
            </b:if>
        </b:if>
      </span>

      <span class='post-timestamp'>
        <b:if cond='data:top.showTimestamp'>
          <data:top.timestampLabel/>
          <b:if cond='data:post.url'>
            <meta expr:content='data:post.url.canonical' itemprop='url'/>
            <a class='timestamp-link' expr:href='data:post.url' rel='bookmark' title='permanent link'><abbr class='published' expr:title='data:post.timestampISO8601' itemprop='datePublished'><data:post.timestamp/></abbr></a>
          </b:if>
        </b:if>
      </span>

      <span class='post-comment-link'>
        <b:include cond='data:blog.pageType not in {&quot;item&quot;,&quot;static_page&quot;}                          and data:post.allowComments' data='post' name='comment_count_picker'/>
      </span>

      <span class='post-icons'>
        <!-- email post links -->
        <b:if cond='data:post.emailPostUrl'>
          <span class='item-action'>
          <a expr:href='data:post.emailPostUrl' expr:title='data:top.emailPostMsg'>
            <img alt='' class='icon-action' height='13' src='https://resources.blogblog.com/img/icon18_email.gif' width='18'/>
          </a>
          </span>
        </b:if>

        <!-- quickedit pencil -->
        <b:include data='post' name='postQuickEdit'/>
      </span>

      <!-- share buttons -->
      <div class='post-share-buttons goog-inline-block'>
        <b:include cond='data:post.sharePostUrl' data='post' name='shareButtons'/>
      </div>

      </div>

      <div class='post-footer-line post-footer-line-2'>
      <span class='post-labels'>
        <b:if cond='data:top.showPostLabels and data:post.labels'>
          <data:postLabelsLabel/>
          <b:loop values='data:post.labels' var='label'>
            <a expr:href='data:label.url' rel='tag'><data:label.name/></a><b:if cond='not data:label.isLast'>,</b:if>
          </b:loop>
        </b:if>
      </span>
      </div>

      <div class='post-footer-line post-footer-line-3'>
      <span class='post-location'>
        <b:if cond='data:top.showLocation and data:post.location'>
          <data:postLocationLabel/>
          <a expr:href='data:post.location.mapsUrl' target='_blank'><data:post.location.name/></a>
        </b:if>
      </span>
      </div>
      <b:if cond='data:post.authorAboutMe'>
        <div class='author-profile' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
          <b:if cond='data:post.authorPhoto.url'>
            <img expr:src='data:post.authorPhoto.url' itemprop='image' width='50px'/>
          </b:if>
          <div>
            <a class='g-profile' expr:href='data:post.authorProfileUrl' itemprop='url' rel='author' title='author profile'>
              <span itemprop='name'><data:post.author/></span>
            </a>
          </div>
          <span itemprop='description'><data:post.authorAboutMe/></span>
        </div>
      </b:if>
    </div>
  </div>
</b:includable>
          <b:includable id='postQuickEdit' var='post'>
  <b:if cond='data:post.editUrl'>
    <span expr:class='&quot;item-control &quot; + data:post.adminClass'>
      <a expr:href='data:post.editUrl' expr:title='data:top.editPostMsg'>
        <img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
      </a>
    </span>
  </b:if>
</b:includable>
          <b:includable id='shareButtons' var='post'>
  <b:if cond='data:top.showEmailButton'><a class='goog-inline-block share-button sb-email' expr:href='data:post.sharePostUrl + &quot;&amp;target=email&quot;' expr:title='data:top.emailThisMsg' target='_blank'><span class='share-button-link-text'><data:top.emailThisMsg/></span></a></b:if><b:if cond='data:top.showBlogThisButton'><a class='goog-inline-block share-button sb-blog' expr:href='data:post.sharePostUrl + &quot;&amp;target=blog&quot;' expr:onclick='&quot;window.open(this.href, \&quot;_blank\&quot;, \&quot;height=270,width=475\&quot;); return false;&quot;' expr:title='data:top.blogThisMsg' target='_blank'><span class='share-button-link-text'><data:top.blogThisMsg/></span></a></b:if><b:if cond='data:top.showTwitterButton'><a class='goog-inline-block share-button sb-twitter' expr:href='data:post.sharePostUrl + &quot;&amp;target=twitter&quot;' expr:title='data:top.shareToTwitterMsg' target='_blank'><span class='share-button-link-text'><data:top.shareToTwitterMsg/></span></a></b:if><b:if cond='data:top.showFacebookButton'><a class='goog-inline-block share-button sb-facebook' expr:href='data:post.sharePostUrl + &quot;&amp;target=facebook&quot;' expr:onclick='&quot;window.open(this.href, \&quot;_blank\&quot;, \&quot;height=430,width=640\&quot;); return false;&quot;' expr:title='data:top.shareToFacebookMsg' target='_blank'><span class='share-button-link-text'><data:top.shareToFacebookMsg/></span></a></b:if><b:if cond='data:top.showPinterestButton'><a class='goog-inline-block share-button sb-pinterest' expr:href='data:post.sharePostUrl + &quot;&amp;target=pinterest&quot;' expr:title='data:top.shareToPinterestMsg' target='_blank'><span class='share-button-link-text'><data:top.shareToPinterestMsg/></span></a></b:if>
</b:includable>
          <b:includable id='status-message'>
  <b:if cond='data:navMessage'>
  <div class='status-msg-wrap'>
    <div class='status-msg-body'>
      <data:navMessage/>
    </div>
    <div class='status-msg-border'>
      <div class='status-msg-bg'>
        <div class='status-msg-hidden'><data:navMessage/></div>
      </div>
    </div>
  </div>
  <div style='clear: both;'/>
  </b:if>
</b:includable>
          <b:includable id='threaded-comment-form' var='post'>
  <div class='comment-form'>
    <a name='comment-form'/>
    <b:if cond='data:mobile'>
      <p><data:blogCommentMessage/></p>
      <data:blogTeamBlogMessage/>
      <a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/>
      <iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' expr:height='data:cmtIframeInitialHeight' frameborder='0' id='comment-editor' name='comment-editor' src='' style='display: none' width='100%'/>
    <b:else/>
      <p><data:blogCommentMessage/></p>
      <data:blogTeamBlogMessage/>
      <a expr:href='data:post.commentFormIframeSrc' id='comment-editor-src'/>
      <iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' expr:height='data:cmtIframeInitialHeight' frameborder='0' id='comment-editor' name='comment-editor' src='' width='100%'/>
    </b:if>
    <data:post.cmtfpIframe/>
    <script type='text/javascript'>
      BLOG_CMT_createIframe(&#39;<data:post.appRpcRelayPath/>&#39;);
    </script>
  </div>
</b:includable>
          <b:includable id='threaded_comment_js' var='post'>
  <script async='async' expr:src='data:post.commentSrc' type='text/javascript'/>

  <script type='text/javascript'>
    (function() {
      var items = <data:post.commentJso/>;
      var msgs = <data:post.commentMsgs/>;
      var config = <data:post.commentConfig/>;

// <![CDATA[
      var cursor = null;
      if (items && items.length > 0) {
        cursor = parseInt(items[items.length - 1].timestamp) + 1;
      }

      var bodyFromEntry = function(entry) {
        var text = (entry &&
                    ((entry.content && entry.content.$t) ||
                     (entry.summary && entry.summary.$t))) ||
            '';
        if (entry && entry.gd$extendedProperty) {
          for (var k in entry.gd$extendedProperty) {
            if (entry.gd$extendedProperty[k].name == 'blogger.contentRemoved') {
              return '<span class="deleted-comment">' + text + '</span>';
            }
          }
        }
        return text;
      }

      var parse = function(data) {
        cursor = null;
        var comments = [];
        if (data && data.feed && data.feed.entry) {
          for (var i = 0, entry; entry = data.feed.entry[i]; i++) {
            var comment = {};
            // comment ID, parsed out of the original id format
            var id = /blog-(\d+).post-(\d+)/.exec(entry.id.$t);
            comment.id = id ? id[2] : null;
            comment.body = bodyFromEntry(entry);
            comment.timestamp = Date.parse(entry.published.$t) + '';
            if (entry.author && entry.author.constructor === Array) {
              var auth = entry.author[0];
              if (auth) {
                comment.author = {
                  name: (auth.name ? auth.name.$t : undefined),
                  profileUrl: (auth.uri ? auth.uri.$t : undefined),
                  avatarUrl: (auth.gd$image ? auth.gd$image.src : undefined)
                };
              }
            }
            if (entry.link) {
              if (entry.link[2]) {
                comment.link = comment.permalink = entry.link[2].href;
              }
              if (entry.link[3]) {
                var pid = /.*comments\/default\/(\d+)\?.*/.exec(entry.link[3].href);
                if (pid && pid[1]) {
                  comment.parentId = pid[1];
                }
              }
            }
            comment.deleteclass = 'item-control blog-admin';
            if (entry.gd$extendedProperty) {
              for (var k in entry.gd$extendedProperty) {
                if (entry.gd$extendedProperty[k].name == 'blogger.itemClass') {
                  comment.deleteclass += ' ' + entry.gd$extendedProperty[k].value;
                } else if (entry.gd$extendedProperty[k].name == 'blogger.displayTime') {
                  comment.displayTime = entry.gd$extendedProperty[k].value;
                }
              }
            }
            comments.push(comment);
          }
        }
        return comments;
      };

      var paginator = function(callback) {
        if (hasMore()) {
          var url = config.feed + '?alt=json&v=2&orderby=published&reverse=false&max-results=50';
          if (cursor) {
            url += '&published-min=' + new Date(cursor).toISOString();
          }
          window.bloggercomments = function(data) {
            var parsed = parse(data);
            cursor = parsed.length < 50 ? null
                : parseInt(parsed[parsed.length - 1].timestamp) + 1
            callback(parsed);
            window.bloggercomments = null;
          }
          url += '&callback=bloggercomments';
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url;
          document.getElementsByTagName('head')[0].appendChild(script);
        }
      };
      var hasMore = function() {
        return !!cursor;
      };
      var getMeta = function(key, comment) {
        if ('iswriter' == key) {
          var matches = !!comment.author
              && comment.author.name == config.authorName
              && comment.author.profileUrl == config.authorUrl;
          return matches ? 'true' : '';
        } else if ('deletelink' == key) {
          return config.baseUri + '/comment/delete/'
               + config.blogId + '/' + comment.id;
        } else if ('deleteclass' == key) {
          return comment.deleteclass;
        }
        return '';
      };

      var replybox = null;
      var replyUrlParts = null;
      var replyParent = undefined;

      var onReply = function(commentId, domId) {
        if (replybox == null) {
          // lazily cache replybox, and adjust to suit this style:
          replybox = document.getElementById('comment-editor');
          if (replybox != null) {
            replybox.height = '250px';
            replybox.style.display = 'block';
            replyUrlParts = replybox.src.split('#');
          }
        }
        if (replybox && (commentId !== replyParent)) {
          replybox.src = '';
          document.getElementById(domId).insertBefore(replybox, null);
          replybox.src = replyUrlParts[0]
              + (commentId ? '&parentID=' + commentId : '')
              + '#' + replyUrlParts[1];
          replyParent = commentId;
        }
      };

      var hash = (window.location.hash || '#').substring(1);
      var startThread, targetComment;
      if (/^comment-form_/.test(hash)) {
        startThread = hash.substring('comment-form_'.length);
      } else if (/^c[0-9]+$/.test(hash)) {
        targetComment = hash.substring(1);
      }

      // Configure commenting API:
      var configJso = {
        'maxDepth': config.maxThreadDepth
      };
      var provider = {
        'id': config.postId,
        'data': items,
        'loadNext': paginator,
        'hasMore': hasMore,
        'getMeta': getMeta,
        'onReply': onReply,
        'rendered': true,
        'initComment': targetComment,
        'initReplyThread': startThread,
        'config': configJso,
        'messages': msgs
      };

      var render = function() {
        if (window.goog && window.goog.comments) {
          var holder = document.getElementById('comment-holder');
          window.goog.comments.render(holder, provider);
        }
      };

      // render now, or queue to render when library loads:
      if (window.goog && window.goog.comments) {
        render();
      } else {
        window.goog = window.goog || {};
        window.goog.comments = window.goog.comments || {};
        window.goog.comments.loadQueue = window.goog.comments.loadQueue || [];
        window.goog.comments.loadQueue.push(render);
      }
    })();
// ]]>
  </script>
</b:includable>
          <b:includable id='threaded_comments' var='post'>
  <div class='comments' id='comments'>
    <a name='comments'/>
    <h4><data:post.commentLabelFull/>:</h4>

    <div class='comments-content'>
      <b:include cond='data:post.embedCommentForm' data='post' name='threaded_comment_js'/>
      <div id='comment-holder'>
         <data:post.commentHtml/>
      </div>
    </div>

    <p class='comment-footer'>
      <b:if cond='data:post.allowNewComments'>
        <b:include data='post' name='threaded-comment-form'/>
      <b:else/>
        <data:post.noNewCommentsText/>
      </b:if>
    </p>

    <b:if cond='data:showCmtPopup'>
      <div id='comment-popup'>
        <iframe allowtransparency='true' frameborder='0' id='comment-actions' name='comment-actions' scrolling='no'>
        </iframe>
      </div>
    </b:if>

    <div id='backlinks-container'>
    <div expr:id='data:widget.instanceId + &quot;_backlinks-container&quot;'>
    </div>
    </div>
  </div>
</b:includable>
        </b:widget>
      </b:section>
    </div>
  </body>
</html>